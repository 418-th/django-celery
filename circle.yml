machine:

  python:
    version: 3.5.1

  node:
    version: 4.2.1

dependencies:
  pre:
    - pip install --upgrade pip

  post:
    - npm install -g gulp bower
    - bower install

  cache_directories:
    - ./node_modules/
    - ./elk/static/vendor/

test:
  pre:
    - gulp production
    - cp elk/.env.circle elk/.env
    - ./manage.py migrate
    - find */fixtures -type f -name '*.yaml'|xargs ./manage.py loaddata

  post:
    - bash <(curl -s https://codecov.io/bash) -t 8ce25f6b-eaf8-442a-aab4-fb6218384b6e
    - git rev-parse HEAD > revision.txt
    - chmod +x ./build/strip-for-production.sh
    - ./build/strip-for-production.sh
